<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to Text Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Standard PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    
    <!-- OCR Engine for Scanned PDFs -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(229, 231, 235, 1);
        }
        #output::-webkit-scrollbar {
            width: 8px;
        }
        #output::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .ocr-active {
            border-color: #f59e0b !important;
            background: #fffbeb !important;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-900 font-sans">

    <div class="max-w-4xl mx-auto px-4 py-12">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-extrabold text-slate-800 tracking-tight mb-2">PDF to Text Converter</h1>
            <p class="text-slate-500">Extract text from digital or scanned PDFs with multi-language support.</p>
        </header>

        <div class="glass-card rounded-2xl shadow-xl p-8 mb-8">
            <!-- File Upload -->
            <div class="mb-8">
                <label for="pdfFile" class="block text-sm font-semibold text-slate-700 mb-2">Upload PDF File</label>
                <div class="flex items-center justify-center w-full">
                    <label id="drop-zone" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-300 rounded-xl cursor-pointer bg-slate-50 hover:bg-slate-100 transition-colors">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <svg class="w-8 h-8 mb-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                            <p class="text-sm text-slate-500" id="file-label">Click to select or drag and drop</p>
                        </div>
                        <input type="file" id="pdfFile" class="hidden" accept=".pdf" />
                    </label>
                </div>
            </div>

            <!-- Options & Progress -->
            <div class="space-y-6 mb-6">
                <div class="flex flex-wrap items-start gap-8">
                    <!-- Extraction Method -->
                    <div class="flex flex-col gap-2">
                        <span class="text-xs font-bold uppercase tracking-wider text-slate-400">Extraction Method</span>
                        <div class="flex items-center space-x-6">
                            <label class="flex items-center cursor-pointer text-sm font-medium">
                                <input type="radio" name="method" value="auto" checked class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-slate-300">
                                <span class="ml-2">Auto-Detect</span>
                            </label>
                            <label class="flex items-center cursor-pointer text-sm font-medium">
                                <input type="radio" name="method" value="ocr" class="w-4 h-4 text-amber-600 focus:ring-amber-500 border-slate-300">
                                <span class="ml-2">Force OCR</span>
                            </label>
                        </div>
                    </div>

                    <!-- Language Selector -->
                    <div class="flex flex-col gap-2">
                        <span class="text-xs font-bold uppercase tracking-wider text-slate-400">OCR Language</span>
                        <select id="langSelect" class="bg-white border border-slate-200 rounded-lg px-3 py-1.5 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                            <option value="eng">English Only</option>
                            <option value="hin">Hindi Only</option>
                            <option value="eng+hin" selected>English + Hindi</option>
                        </select>
                    </div>

                    <!-- Page Range Selector -->
                    <div class="flex flex-col gap-2">
                        <span class="text-xs font-bold uppercase tracking-wider text-slate-400">Page Range</span>
                        <div class="flex items-center gap-2">
                            <input type="text" id="pageRange" placeholder="e.g. 1-3, 5" class="bg-white border border-slate-200 rounded-lg px-3 py-1.5 text-sm font-medium w-32 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                            <span class="text-xs text-slate-400" id="pageCountLabel"></span>
                        </div>
                    </div>
                    
                    <!-- Status Indicator -->
                    <div id="status-container" class="hidden flex items-center bg-blue-50 px-4 py-2 rounded-full border border-blue-100 shadow-sm animate-pulse ml-auto">
                        <svg class="animate-spin -ml-1 mr-3 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span class="text-sm font-bold text-blue-700"><span id="status-text">Processing</span>: <span id="progress-percent">0%</span></span>
                    </div>
                </div>
            </div>

            <!-- Output Display -->
            <div class="relative group mb-8">
                <div class="absolute right-4 top-4 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                    <button id="copyBtn" class="bg-white px-3 py-1 border border-slate-200 rounded-md text-xs font-medium hover:bg-slate-50 shadow-sm active:scale-95 transition-transform">Copy Text</button>
                </div>
                <textarea id="output" 
                    placeholder="Extracted text will appear here..."
                    class="w-full h-96 p-6 bg-slate-900 text-slate-300 rounded-xl border border-slate-700 font-mono text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500/50"
                    readonly></textarea>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                <button id="processBtn" 
                    class="w-full sm:w-auto px-12 py-4 btn-primary text-white font-bold rounded-xl shadow-lg hover:shadow-blue-500/30 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                    Process PDF
                </button>
                <button id="clearBtn" 
                    class="w-full sm:w-auto px-12 py-4 bg-white text-slate-600 border border-slate-200 font-bold rounded-xl hover:bg-slate-50 transition-all">
                    Clear All
                </button>
            </div>
        </div>
        
        <p class="text-center text-slate-400 text-sm">
            Format: "1-3" for range, "1, 3, 5" for specific pages. Leave blank for the whole document.
        </p>
    </div>

    <script>
        const pdfjsLib = window['pdfjs-dist/build/pdf'];
        if (pdfjsLib) pdfjsLib.GlobalWorkerOptions.workerSrc = '';

        const fileInput = document.getElementById('pdfFile');
        const fileLabel = document.getElementById('file-label');
        const output = document.getElementById('output');
        const processBtn = document.getElementById('processBtn');
        const clearBtn = document.getElementById('clearBtn');
        const copyBtn = document.getElementById('copyBtn');
        const statusContainer = document.getElementById('status-container');
        const progressPercent = document.getElementById('progress-percent');
        const statusText = document.getElementById('status-text');
        const dropZone = document.getElementById('drop-zone');
        const langSelect = document.getElementById('langSelect');
        const pageRangeInput = document.getElementById('pageRange');
        const pageCountLabel = document.getElementById('pageCountLabel');
        
        let currentPdf = null;
        let selectedFile = null;

        // File selection only prepares the metadata
        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            selectedFile = file;
            fileLabel.textContent = file.name;
            
            // Just read the page count first
            try {
                const arrayBuffer = await file.arrayBuffer();
                const typedarray = new Uint8Array(arrayBuffer);
                currentPdf = await pdfjsLib.getDocument({ data: typedarray }).promise;
                pageCountLabel.textContent = `(Total: ${currentPdf.numPages})`;
                output.value = `File loaded: ${file.name}. \nTotal pages: ${currentPdf.numPages}. \nAdjust settings above and click "Process PDF" to begin extraction.`;
            } catch (err) {
                output.value = "Error reading PDF structure: " + err.message;
            }
        });

        // Trigger extraction only on click
        processBtn.addEventListener('click', async () => {
            if (!currentPdf) {
                alertBox("Please select a PDF file first.");
                return;
            }
            await runExtraction();
        });

        async function runExtraction() {
            statusContainer.classList.remove('hidden');
            progressPercent.textContent = "0%";
            statusText.textContent = "Processing";
            processBtn.disabled = true;
            
            try {
                const useOCR = document.querySelector('input[name="method"]:checked').value === 'ocr';
                let fullText = '';
                
                if (useOCR) {
                    fullText = await runOCR(currentPdf);
                } else {
                    fullText = await extractDigitalText(currentPdf);
                    if (fullText.trim().length < 20) {
                        statusText.textContent = "Switching to OCR";
                        fullText = await runOCR(currentPdf);
                    }
                }
                
                output.value = fullText.trim() || "No text could be extracted from the specified pages.";

            } catch (err) {
                output.value = "Error during processing: " + err.message;
            } finally {
                processBtn.disabled = false;
                setTimeout(() => statusContainer.classList.add('hidden'), 500);
            }
        }

        function getPageList(numPages) {
            const rangeStr = pageRangeInput.value.trim();
            if (!rangeStr) {
                return Array.from({length: numPages}, (_, i) => i + 1);
            }

            const pages = new Set();
            const parts = rangeStr.split(',');
            
            parts.forEach(part => {
                if (part.includes('-')) {
                    const [start, end] = part.split('-').map(p => parseInt(p.trim()));
                    if (!isNaN(start) && !isNaN(end)) {
                        const s = Math.min(start, end);
                        const e = Math.max(start, end);
                        for (let i = Math.max(1, s); i <= Math.min(numPages, e); i++) {
                            pages.add(i);
                        }
                    }
                } else {
                    const p = parseInt(part.trim());
                    if (!isNaN(p) && p >= 1 && p <= numPages) {
                        pages.add(p);
                    }
                }
            });

            return Array.from(pages).sort((a, b) => a - b);
        }

        async function extractDigitalText(pdf) {
            let text = '';
            const targetPages = getPageList(pdf.numPages);
            if (targetPages.length === 0) throw new Error("No valid pages in range.");
            
            for (let i = 0; i < targetPages.length; i++) {
                const pageNum = targetPages[i];
                statusText.textContent = `Extracting Page ${pageNum}`;
                const page = await pdf.getPage(pageNum);
                const textContent = await page.getTextContent();
                let lastY = -1;
                textContent.items.forEach(item => {
                    if (lastY !== -1 && Math.abs(item.transform[5] - lastY) > 5) text += '\n';
                    text += item.str + ' ';
                    lastY = item.transform[5];
                });
                text += '\n\n';
                progressPercent.textContent = `${Math.round(((i + 1) / targetPages.length) * 100)}%`;
            }
            return text;
        }

        async function runOCR(pdf) {
            statusText.textContent = "Loading OCR Engine";
            dropZone.classList.add('ocr-active');
            let text = '';
            
            const targetPages = getPageList(pdf.numPages);
            if (targetPages.length === 0) {
                dropZone.classList.remove('ocr-active');
                throw new Error("No valid pages selected in the range.");
            }

            const selectedLangs = langSelect.value.split('+');
            const worker = await Tesseract.createWorker(selectedLangs, 1);

            for (let i = 0; i < targetPages.length; i++) {
                const pageNum = targetPages[i];
                statusText.textContent = `OCR Page ${pageNum} (${i+1}/${targetPages.length})`;
                const page = await pdf.getPage(pageNum);
                
                const viewport = page.getViewport({ scale: 2.5 }); 
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                await page.render({ canvasContext: context, viewport: viewport }).promise;
                
                const { data: { text: pageText } } = await worker.recognize(canvas);
                text += `--- Page ${pageNum} ---\n` + pageText + '\n\n';
                progressPercent.textContent = `${Math.round(((i + 1) / targetPages.length) * 100)}%`;
            }

            await worker.terminate();
            dropZone.classList.remove('ocr-active');
            return text;
        }

        function alertBox(msg) {
            output.value = "⚠️ " + msg;
        }

        clearBtn.addEventListener('click', () => {
            fileInput.value = '';
            fileLabel.textContent = 'Click to select or drag and drop';
            output.value = '';
            pageCountLabel.textContent = '';
            currentPdf = null;
            selectedFile = null;
        });

        copyBtn.addEventListener('click', () => {
            if (!output.value) return;
            const textarea = document.createElement('textarea');
            textarea.value = output.value;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            copyBtn.textContent = 'Copied!';
            setTimeout(() => copyBtn.textContent = 'Copy Text', 2000);
        });
    </script>
</body>
</html>